{
  "openapi" : "3.0.0",
  "servers" : [ {
    "url" : "http://developer-dev.api.bimbox.cn/permission/v1"
  }, {
    "url" : "https://developer-dev.api.bimbox.cn/permission/v1"
  } ],
  "info" : {
    "description" : "权限管理服务\n",
    "version" : "1.0.0",
    "title" : "AECWorks BIMServer Permission Service",
    "termsOfService" : "http://www.aecworks.cn/terms/",
    "contact" : {
      "email" : "apiteam@aecworks.cn"
    },
    "license" : {
      "name" : "上海开建信息技术有限公司",
      "url" : "http://www.AECWorks.cn/licenses"
    }
  },
  "tags" : [ {
    "name" : "Catalog",
    "description" : "Permission Catalog",
    "externalDocs" : {
      "description" : "Find out more",
      "url" : "http://www.aecworks.cn"
    }
  }, {
    "name" : "Permission",
    "description" : "Permission",
    "externalDocs" : {
      "description" : "Find out more",
      "url" : "http://www.aecworks.cn"
    }
  } ],
  "paths" : {
    "/catalogs" : {
      "post" : {
        "tags" : [ "Catalog" ],
        "summary" : "为当前的 client 创建一个 Permission Catalog",
        "operationId" : "addCatalog",
        "responses" : {
          "200" : {
            "description" : "创建成功，并返回创建的 Permission Catalog 对象",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PermissionCatalogDataWrapper"
                }
              }
            }
          },
          "401" : {
            "$ref" : "#components/responses/UnauthorizedError"
          },
          "403" : {
            "$ref" : "#components/responses/ForbiddenError"
          },
          "405" : {
            "description" : "catalog key 的格式不对, 接受的字符为：字母，下划线和数字",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#components/schemas/ErrorModel"
                }
              }
            }
          },
          "409" : {
            "description" : "当前的 client 下已经有同名的 catalog key",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#components/schemas/ErrorModel"
                },
                "example" : {
                  "code" : "",
                  "message" : "CatalogKeyConflict:my_key_1"
                }
              }
            }
          }
        },
        "requestBody" : {
          "$ref" : "#/components/requestBodies/PermissionCatalog"
        }
      },
      "put" : {
        "tags" : [ "Catalog" ],
        "summary" : "为当前的 client 更新指定的 Permission Catalog",
        "operationId" : "updateCatalog",
        "responses" : {
          "200" : {
            "description" : "更新成功，并在返回更新后的 Permission Catalog 对象",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PermissionCatalogsDataWrapper"
                }
              }
            }
          },
          "401" : {
            "$ref" : "#components/responses/UnauthorizedError"
          },
          "403" : {
            "$ref" : "#components/responses/ForbiddenError"
          },
          "404" : {
            "description" : "catalog key 不存在",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#components/schemas/ErrorModel"
                },
                "example" : {
                  "code" : "NoSuchCatalogKey",
                  "message" : "请求的资源不存在，该资源标识为：some_resource_id。可以将此信息告诉应用的开发人员。",
                  "developerMessage" : "hello"
                }
              }
            }
          }
        },
        "requestBody" : {
          "$ref" : "#/components/requestBodies/PermissionCatalogs"
        }
      },
      "get" : {
        "tags" : [ "Catalog" ],
        "summary" : "获取当前 client 所有的 Permission Catalog",
        "operationId" : "getCatalogs",
        "responses" : {
          "200" : {
            "description" : "",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PermissionCatalogsDataWrapper"
                }
              }
            }
          },
          "401" : {
            "$ref" : "#components/responses/UnauthorizedError"
          },
          "403" : {
            "$ref" : "#components/responses/ForbiddenError"
          }
        }
      }
    },
    "/catalogs/{catalogKey}" : {
      "get" : {
        "summary" : "Get a user by ID",
        "tags" : [ "Catalog" ],
        "parameters" : [ {
          "in" : "path",
          "name" : "catalogKey",
          "schema" : {
            "type" : "string"
          },
          "required" : true,
          "description" : "希望获取的 Permission Catalog 的key"
        } ],
        "responses" : {
          "200" : {
            "description" : "",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PermissionCatalogDataWrapper"
                }
              }
            }
          }
        }
      }
    },
    "/catalogs/{catalogKey}/permissions" : {
      "post" : {
        "tags" : [ "Permission" ],
        "parameters" : [ {
          "in" : "path",
          "name" : "catalogKey",
          "schema" : {
            "type" : "string"
          },
          "required" : true,
          "description" : "希望获取的 Permission Catalog 的key"
        } ],
        "summary" : "为当前的 client 创建一个 Permission",
        "operationId" : "addPermission",
        "responses" : {
          "200" : {
            "description" : "",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PermissionDataWrapper"
                }
              }
            }
          },
          "401" : {
            "$ref" : "#components/responses/UnauthorizedError"
          },
          "403" : {
            "$ref" : "#components/responses/ForbiddenError"
          },
          "405" : {
            "description" : "catalog key 的格式不对, 接受的字符为：字母，下划线和数字",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorModel"
                }
              }
            }
          },
          "409" : {
            "description" : "当前的 client 下已经有同名的 catalog key",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorModel"
                }
              }
            }
          }
        },
        "requestBody" : {
          "$ref" : "#/components/requestBodies/PermissionCatalog"
        }
      },
      "put" : {
        "tags" : [ "Permission" ],
        "summary" : "为当前的 client 更新指定的 Permission Catalog",
        "operationId" : "updatePermission",
        "responses" : {
          "401" : {
            "$ref" : "#components#/responses/UnauthorizedError"
          },
          "403" : {
            "$ref" : "#components/responses/ForbiddenError"
          },
          "404" : {
            "description" : "catalog key 不存在",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorModel"
                }
              }
            }
          }
        },
        "requestBody" : {
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/Permission"
              }
            }
          },
          "description" : "一个完整的 Permission Catalog 对象",
          "required" : true
        }
      },
      "get" : {
        "tags" : [ "Permission" ],
        "summary" : "获取当前 client 所有的 Permission Catalog",
        "operationId" : "getPermission",
        "responses" : {
          "200" : {
            "description" : "",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PermissionCatalogDataWrapper"
                }
              }
            }
          },
          "401" : {
            "$ref" : "#components/responses/UnauthorizedError"
          },
          "403" : {
            "$ref" : "#components/responses/ForbiddenError"
          }
        }
      }
    }
  },
  "components" : {
    "schemas" : {
      "ErrorModel" : {
        "required" : [ "code", "message" ],
        "properties" : {
          "code" : {
            "type" : "string",
            "description" : "错误代码，采用 Pascal 命名规则，能够简短的表达错误原因。客户端可以使用该错误代码做国际化相关工作。",
            "example" : "NoSuchCatalogKey"
          },
          "message" : {
            "type" : "string",
            "description" : "能够直接展示给用户的错误原因的描述，默认语言为中文。",
            "example" : "-> 请求的资源不存在，该资源标识为：some_resource_id。可以将此信息告诉应用的开发人员。"
          },
          "developerMessage" : {
            "type" : "string",
            "description" : "为开发人员提供的详细的错误原因的描述，方便开发人员进行调试和差错。默认语言为中文。",
            "example" : "服务端接收到的 Catalog Key   为：my_catalog_key。请仔细检查Key的字符和编码格式是否跟客户端请求的一致。如果一致，请确认创建过该Catalog Key。如果不一致，可以考虑编码格式。Catalog Key 需要采用 URL-SAFE 的字符，否则在 http 请求中，某些字符会被转意，或者是截断。"
          },
          "moreInfo" : {
            "type" : "string",
            "description" : "如果必要，这里会有关于该错误的一些详细信息，一般是一个web页面的链接。",
            "example" : "https://developer.aecworks.cn/appName/serviceName/errors/errorCode"
          }
        }
      },
      "PermissionCatalog" : {
        "type" : "object",
        "required" : [ "key" ],
        "properties" : {
          "key" : {
            "type" : "string",
            "description" : "Permission Catalog的 key， 用来标识和组织一组 Permission。接受的字符为：字母和数字，分隔符为下划线 _。",
            "minimum" : 4,
            "maximum" : 128,
            "example" : "bimbox_document_access_catalog_v1"
          },
          "description" : {
            "type" : "string",
            "description" : "对 Permission Catalog 的简短描述",
            "maximum" : 512,
            "example" : "BIMBox App使用这个Catalog来管理和控制文档的访问权限。"
          }
        }
      },
      "PermissionCatalogs" : {
        "type" : "object",
        "required" : [ "count", "permissionCatalogs" ],
        "properties" : {
          "count" : {
            "type" : "integer",
            "format" : "int32",
            "example" : 1
          },
          "permissionCatalogs" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/PermissionCatalog"
            }
          }
        }
      },
      "PermissionCatalogDataWrapper" : {
        "type" : "object",
        "required" : [ "data" ],
        "properties" : {
          "data" : {
            "$ref" : "#/components/schemas/PermissionCatalog"
          }
        }
      },
      "PermissionCatalogsDataWrapper" : {
        "type" : "object",
        "required" : [ "data" ],
        "properties" : {
          "data" : {
            "$ref" : "#/components/schemas/PermissionCatalogs"
          }
        }
      },
      "Permission" : {
        "type" : "object",
        "required" : [ "key", "catalogKey", "bitIndex", "code" ],
        "properties" : {
          "key" : {
            "type" : "string",
            "description" : "",
            "minimum" : 4,
            "maximum" : 128,
            "example" : ""
          },
          "catalogKey" : {
            "type" : "string",
            "description" : "",
            "minimum" : 4,
            "maximum" : 128,
            "example" : ""
          },
          "bitIndex" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "",
            "example" : 4
          },
          "code" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "",
            "example" : 32
          },
          "description" : {
            "type" : "string",
            "description" : "",
            "maximum" : 512,
            "example" : ""
          }
        }
      },
      "Permissions" : {
        "type" : "object",
        "required" : [ "count", "permissions" ],
        "properties" : {
          "count" : {
            "type" : "integer",
            "format" : "int32",
            "example" : 1
          },
          "permissions" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/Permission"
            }
          }
        }
      },
      "PermissionDataWrapper" : {
        "type" : "object",
        "required" : [ "data" ],
        "properties" : {
          "data" : {
            "$ref" : "#/components/schemas/Permission"
          }
        }
      },
      "PermissionsDataWrapper" : {
        "type" : "object",
        "required" : [ "data" ],
        "properties" : {
          "data" : {
            "$ref" : "#/components/schemas/Permissions"
          }
        }
      }
    },
    "responses" : {
      "GeneralError" : {
        "description" : "General Error",
        "$ref" : "#/components/schemas/ErrorModel"
      },
      "UnauthorizedError" : {
        "description" : "无法验证Client的身份，请确认已经登录，并获得有效的Token"
      },
      "ForbiddenError" : {
        "description" : "当前Client的授权无法访问请求的资源"
      },
      "ResourceNotFoundError" : {
        "description" : "请求的资源不存在",
        "$ref" : "#/components/schemas/ErrorModel"
      }
    },
    "requestBodies" : {
      "PermissionCatalog" : {
        "content" : {
          "application/json" : {
            "schema" : {
              "$ref" : "#/components/schemas/PermissionCatalog"
            }
          }
        },
        "description" : "一个 Permission Catalog 对象",
        "required" : true
      },
      "PermissionCatalogs" : {
        "content" : {
          "application/json" : {
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/components/schemas/PermissionCatalog"
              }
            }
          }
        },
        "description" : "一个 Permission Catalog 对象",
        "required" : true
      }
    }
  }
}